module.exports = function generatePromptContract(data) {
    try {
        if (!data || typeof data !== 'object') {
            throw new Error('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–º–ø—Ç–∞');
        }

        // ==== –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ====
        const clean = (v) => {
            if (v === null || v === undefined) return '';
            return String(v).replace(/\s+/g, ' ').trim();
        };
        const cleanMultiline = (v) => {
            if (!v) return '';
            return String(v)
                .split('\n')
                .map((x) => x.replace(/\s+/g, ' ').trim())
                .filter(Boolean)
                .join('\n');
        };
        const has = (v) => clean(v).length > 0;

        const line = (label, value) =>
            `${label}: ${has(value) ? clean(value) : '___'}`;

        const block = (label, value) =>
            `${label}:\n${has(value) ? cleanMultiline(value) : '___'}`;

        const pickType = (d) => {
            const custom = clean(d.custom_contract_type);
            if (custom) return custom;
            const std = clean(d.contract_type);
            return std || '___';
        };

        const rolesToParties = (yourRole) => {
            const r = clean(yourRole).toLowerCase();
            const map = {
                '–ø—Ä–æ–¥–∞–≤–µ—Ü': ['–ü—Ä–æ–¥–∞–≤–µ—Ü', '–ü–æ–∫—É–ø–∞—Ç–µ–ª—å'],
                '–ø–æ–∫—É–ø–∞—Ç–µ–ª—å': ['–ü–æ–∫—É–ø–∞—Ç–µ–ª—å', '–ü—Ä–æ–¥–∞–≤–µ—Ü'],
                '–∞—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª—å': ['–ê—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª—å', '–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä'],
                '–∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä': ['–ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä', '–ê—Ä–µ–Ω–¥–æ–¥–∞—Ç–µ–ª—å'],
                '–∑–∞–∫–∞–∑—á–∏–∫': ['–ó–∞–∫–∞–∑—á–∏–∫', '–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å'],
                '–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å': ['–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å', '–ó–∞–∫–∞–∑—á–∏–∫'],
                '–∑–∞–π–º–æ–¥–∞–≤–µ—Ü': ['–ó–∞–π–º–æ–¥–∞–≤–µ—Ü', '–ó–∞–µ–º—â–∏–∫'],
                '–∑–∞–µ–º—â–∏–∫': ['–ó–∞–µ–º—â–∏–∫', '–ó–∞–π–º–æ–¥–∞–≤–µ—Ü'],
                '–¥–∞—Ä–∏—Ç–µ–ª—å': ['–î–∞—Ä–∏—Ç–µ–ª—å', '–û–¥–∞—Ä—è–µ–º—ã–π'],
                '–æ–¥–∞—Ä—è–µ–º—ã–π': ['–û–¥–∞—Ä—è–µ–º—ã–π', '–î–∞—Ä–∏—Ç–µ–ª—å'],
                '—É—á–∞—Å—Ç–Ω–∏–∫ 1': ['–£—á–∞—Å—Ç–Ω–∏–∫ 1', '–£—á–∞—Å—Ç–Ω–∏–∫ 2'],
                '—É—á–∞—Å—Ç–Ω–∏–∫ 2': ['–£—á–∞—Å—Ç–Ω–∏–∫ 2', '–£—á–∞—Å—Ç–Ω–∏–∫ 1'],
            };
            for (const key of Object.keys(map)) {
                if (r.includes(key)) {
                    const [p1, p2] = map[key];
                    return { party1Title: p1, party2Title: p2 };
                }
            }
            return { party1Title: '–°—Ç–æ—Ä–æ–Ω–∞ 1', party2Title: '–°—Ç–æ—Ä–æ–Ω–∞ 2' };
        };

        const normalizeDuration = (d) => {
            const base = clean(d.duration);
            const details = clean(d.duration_details || d.duration_text || d.duration_extra);
            if (!base && !details) return '___';
            if (/–±–µ—Å—Å—Ä–æ—á/i.test(base)) {
                return '–ë–µ—Å—Å—Ä–æ—á–Ω—ã–π –¥–æ–≥–æ–≤–æ—Ä. –ö–∞–∂–¥–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ –≤–ø—Ä–∞–≤–µ —Ä–∞—Å—Ç–æ—Ä–≥–Ω—É—Ç—å –¥–æ–≥–æ–≤–æ—Ä —Å –ø–∏—Å—å–º–µ–Ω–Ω—ã–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º –∑–∞ 30 –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö –¥–Ω–µ–π.';
            }
            if (/—É–∫–∞–∑–∞–Ω–∏/i.test(base) || details) {
                return details || base || '___';
            }
            return base || '___';
        };

        const normalizePayment = (d) => {
            const base = clean(d.payment_terms);
            const details = cleanMultiline(d.payment_terms_details);
            if (!base && !details) return '___';
            if (/—á–∞—Å—Ç/i.test(base)) {
                if (details) return `–û–ø–ª–∞—Ç–∞ –ø–æ —ç—Ç–∞–ø–∞–º: ${details}`;
                // –∏–Ω–æ–≥–¥–∞ Tilda –º–æ–∂–µ—Ç —Å–∫–ª–µ–∏—Ç—å —Ç–µ–∫—Å—Ç —ç—Ç–∞–ø–æ–≤ –≤ –æ–¥–Ω–æ –ø–æ–ª–µ
                const fromBase = base.split(/[:‚Äî-]/).slice(1).join(' ').trim();
                return fromBase ? `–û–ø–ª–∞—Ç–∞ –ø–æ —ç—Ç–∞–ø–∞–º: ${fromBase}` : '–û–ø–ª–∞—Ç–∞ —á–∞—Å—Ç—è–º–∏ (—ç—Ç–∞–ø—ã: ___).';
            }
            if (/–ø—Ä–µ–¥–æ–ø–ª–∞—Ç/i.test(base)) return '–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞.';
            if (/–ø–æ—Å—Ç–æ–ø–ª–∞—Ç/i.test(base)) return '–ü–æ—Å—Ç–æ–ø–ª–∞—Ç–∞.';
            return base || '___';
        };

        const detectHintsByType = (type) => {
            const t = clean(type).toLowerCase();
            const hints = [];
            if (t.includes('–∫—É–ø–ª—è-–ø—Ä–æ–¥–∞–∂–∞ –∞–≤—Ç–æ') || t.includes('–º–æ—Ç–æ')) {
                hints.push('–î–æ–±–∞–≤—å —É—Å–ª–æ–≤–∏—è: –ø–µ—Ä–µ—Ö–æ–¥ –ø—Ä–∞–≤–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –Ω–∞ –¢–°, —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¢–°, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–µ–º–µ–Ω–µ–Ω–∏–π, –ü–¢–°/–°–¢–°, –ø–µ—Ä–µ–¥–∞—á–∞ –∫–ª—é—á–µ–π –∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ –ì–ò–ë–î–î.');
            }
            if (t.includes('–∫—É–ø–ª—è-–ø—Ä–æ–¥–∞–∂–∞') && !t.includes('–∞–≤—Ç–æ') && !t.includes('–º–æ—Ç–æ') && !t.includes('–Ω–µ–¥–≤–∏–∂')) {
                hints.push('–î–ª—è –¥–≤–∏–∂–∏–º–æ–≥–æ –∏–º—É—â–µ—Å—Ç–≤–∞: –∫–æ–º–ø–ª–µ–∫—Ç–Ω–æ—Å—Ç—å, –∫–∞—á–µ—Å—Ç–≤–æ, –º–æ–º–µ–Ω—Ç –ø–µ—Ä–µ—Ö–æ–¥–∞ —Ä–∏—Å–∫–∞, –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏–µ–º–∫–∏.');
            }
            if (t.includes('–Ω–µ–¥–≤–∏–∂')) {
                hints.push('–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å: —Ç–æ—á–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ (–∞–¥—Ä–µ—Å, –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–π –Ω–æ–º–µ—Ä), –ø–µ—Ä–µ–¥–∞—Ç–æ—á–Ω—ã–π –∞–∫—Ç, –ø–æ—Ä—è–¥–æ–∫ —Ä–∞—Å—á—ë—Ç–æ–≤, –≥–æ—Å—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –ø—Ä–∞–≤–∞, –∫–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏ –¥–æ/–ø–æ—Å–ª–µ –ø–µ—Ä–µ–¥–∞—á–∏.');
            }
            if (t.includes('–¥–∞—Ä–µ–Ω–∏–µ')) {
                hints.push('–î–∞—Ä–µ–Ω–∏–µ: –±–µ–∑–≤–æ–∑–º–µ–∑–¥–Ω–æ—Å—Ç—å, –ø—Ä–µ–¥–º–µ—Ç –¥–∞—Ä–µ–Ω–∏—è, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–µ–º–µ–Ω–µ–Ω–∏–π, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–æ–≥–ª–∞—Å–∏—è.');
            }
            if (t.includes('–∞—Ä–µ–Ω–¥–∞') && (t.includes('–∂–∏–ª—å') || t.includes('–∫–≤–∞—Ä—Ç–∏—Ä–∞') || t.includes('–¥–æ–º'))) {
                hints.push('–ê—Ä–µ–Ω–¥–∞ –∂–∏–ª—å—è: –ø—Ä–∞–≤–∏–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, –∑–∞–ª–æ–≥/–¥–µ–ø–æ–∑–∏—Ç, –∫–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏, –ø–æ—Ä—è–¥–æ–∫ —Ä–∞—Å—Ç–æ—Ä–∂–µ–Ω–∏—è –∏ –≤–æ–∑–≤—Ä–∞—Ç–∞.');
            }
            if (t.includes('–∞—Ä–µ–Ω–¥–∞') && (t.includes('–∫–æ–º–º–µ—Ä—á–µ—Å') || t.includes('–æ—Ñ–∏—Å') || t.includes('—Å–∫–ª–∞–¥'))) {
                hints.push('–ê—Ä–µ–Ω–¥–∞ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è: –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ, —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è, —Ä–µ–º–æ–Ω—Ç/—É–ª—É—á—à–µ–Ω–∏—è, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å, —Å—É–±–∞—Ä–µ–Ω–¥–∞ (–ø–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—é).');
            }
            if (t.includes('–∞—Ä–µ–Ω–¥–∞') && (t.includes('—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç') || t.includes('–∞–≤—Ç–æ') || t.includes('—Å–ø–µ—Ü—Ç–µ—Ö'))) {
                hints.push('–ê—Ä–µ–Ω–¥–∞ –¢–°: —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è, –ì–°–ú/–¢–û, —à—Ç—Ä–∞—Ñ—ã/–î–¢–ü, –ª–∏–º–∏—Ç—ã –ø—Ä–æ–±–µ–≥–∞/–≤—Ä–µ–º–µ–Ω–∏, –ø–µ—Ä–µ–¥–∞—Ç–æ—á–Ω—ã–π –∞–∫—Ç.');
            }
            if (t.includes('–ø–æ–¥—Ä—è–¥') || t.includes('—Å—Ç—Ä–æ–∏—Ç–µ–ª—å') || t.includes('—Ä–µ–º–æ–Ω—Ç')) {
                hints.push('–ü–æ–¥—Ä—è–¥: –¢–ó/—Å–º–µ—Ç–∞, —ç—Ç–∞–ø—ã –∏ —Å—Ä–æ–∫–∏, –≥–∞—Ä–∞–Ω—Ç–∏—è, –ø–æ—Ä—è–¥–æ–∫ –ø—Ä–∏–µ–º–∫–∏, –Ω–µ—É—Å—Ç–æ–π–∫–∏ –∑–∞ –ø—Ä–æ—Å—Ä–æ—á–∫—É.');
            }
            if (t.includes('—É—Å–ª—É–≥–∏') || t.includes('b2b') || t.includes('it')) {
                hints.push('–£—Å–ª—É–≥–∏/IT/B2B: SLA/–º–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞, –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å, –ø—Ä–∞–≤–∞ –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (–ø–µ—Ä–µ–¥–∞—á–∞/–ª–∏—Ü–µ–Ω–∑–∏—è), –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å.');
            }
            if (t.includes('–ø–æ—Å—Ç–∞–≤–∫–∞')) {
                hints.push('–ü–æ—Å—Ç–∞–≤–∫–∞: –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞ –∏ –≥—Ä–∞—Ñ–∏–∫, —Ç–∞—Ä–∞/—É–ø–∞–∫–æ–≤–∫–∞, –ø—Ä–∏–µ–º–∫–∞ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∏ –∫–∞—á–µ—Å—Ç–≤—É, INCOTERMS –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.');
            }
            if (t.includes('–∞–≥–µ–Ω—Ç—Å–∫')) {
                hints.push('–ê–≥–µ–Ω—Ç—Å–∫–∏–π: –ø—Ä–µ–¥–º–µ—Ç –ø–æ—Ä—É—á–µ–Ω–∏—è, –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ (–ø—Ä–æ—Ü–µ–Ω—Ç/—Ñ–∏–∫—Å), –æ—Ç—á–µ—Ç –∞–≥–µ–Ω—Ç–∞, –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤, –∑–∞–ø—Ä–µ—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).');
            }
            if (t.includes('–∫–æ–º–∏—Å—Å–∏')) {
                hints.push('–ö–æ–º–∏—Å—Å–∏—è: –ø—Ä–µ–¥–º–µ—Ç –∫–æ–º–∏—Å—Å–∏–∏, –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ, –æ—Ç—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–æ–Ω–µ—Ä–∞, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –≤—ã–±–æ—Ä –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤.');
            }
            if (t.includes('–∑–∞–π–º') || t.includes('–∫—Ä–µ–¥–∏—Ç')) {
                hints.push('–ó–∞–µ–º: —Å—É–º–º–∞, —Å—Ä–æ–∫, –ø—Ä–æ—Ü–µ–Ω—Ç—ã/–±–µ—Å–ø—Ä–æ—Ü–µ–Ω—Ç–Ω–æ, –≥—Ä–∞—Ñ–∏–∫ –≤–æ–∑–≤—Ä–∞—Ç–∞, –Ω–µ—É—Å—Ç–æ–π–∫–∞, –¥–æ—Å—Ä–æ—á–Ω–æ–µ –ø–æ–≥–∞—à–µ–Ω–∏–µ, —Ä–∞—Å–ø–∏—Å–∫–∞.');
            }
            if (t.includes('—Å–æ–≤–º–µ—Å—Ç–Ω–æ–π –¥–µ—è—Ç–µ–ª—å')) {
                hints.push('–°–æ–≤–º–µ—Å—Ç–Ω–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –≤–∫–ª–∞–¥—ã —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏–±—ã–ª–∏/—É–±—ã—Ç–∫–æ–≤, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, —É—á–µ—Ç, –≤—ã—Ö–æ–¥ —É—á–∞—Å—Ç–Ω–∏–∫–∞.');
            }
            if (t.includes('–∞–≤—Ç–æ—Ä—Å–∫') || t.includes('—Ñ–æ—Ç–æ') || t.includes('–¥–∏–∑–∞–π–Ω') || t.includes('—Ç–µ–∫—Å—Ç—ã')) {
                hints.push('–ê–≤—Ç–æ—Ä—Å–∫–∏–π: –ø–µ—Ä–µ–¥–∞—á–∞/–ª–∏—Ü–µ–Ω–∑–∏—è –Ω–∞ –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞, —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è, —Å—Ä–æ–∫, —Å–ø–æ—Å–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ, –º–æ—Ä–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞.');
            }
            if (t.includes('—Ö—Ä–∞–Ω–µ–Ω')) {
                hints.push('–•—Ä–∞–Ω–µ–Ω–∏–µ: –ø—Ä–µ–¥–º–µ—Ç, —É—Å–ª–æ–≤–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å —Ö—Ä–∞–Ω–∏—Ç–µ–ª—è, —Å—Ä–æ–∫–∏ –∏ –ø–æ—Ä—è–¥–æ–∫ –≤–æ–∑–≤—Ä–∞—Ç–∞.');
            }
            return hints;
        };

        // ==== –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö ====
        const type = pickType(data);
        const yourRole = clean(data.your_role);
        const { party1Title, party2Title } = rolesToParties(yourRole);

        const durationText = normalizeDuration(data);
        const paymentText = normalizePayment(data);
        const amountText = has(data.contract_amount) ? clean(data.contract_amount) : '___';

        const parts = [];

        // –ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è
        parts.push(line('–¢–∏–ø –¥–æ–≥–æ–≤–æ—Ä–∞', type));
        parts.push(line('–†–æ–ª—å –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞', yourRole || '___'));
        parts.push('');
        parts.push(block(`–°—Ç–æ—Ä–æ–Ω–∞ 1 (${party1Title})`, data.your_info));
        parts.push('');
        parts.push(block(`–°—Ç–æ—Ä–æ–Ω–∞ 2 (${party2Title})`, data.counterparty_info));
        parts.push('');
        parts.push(block('–ü—Ä–µ–¥–º–µ—Ç / –æ–ø–∏—Å–∞–Ω–∏–µ', data.contract_description));
        parts.push('');
        parts.push(line('–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è', durationText));
        parts.push(line('–¶–µ–Ω–∞ / —Å—É–º–º–∞ –ø–æ –¥–æ–≥–æ–≤–æ—Ä—É', amountText));
        parts.push(line('–ü–æ—Ä—è–¥–æ–∫ –æ–ø–ª–∞—Ç—ã', paymentText));
        parts.push('');
        parts.push(line('Email', data.email));
        parts.push(line('–¢–µ–ª–µ—Ñ–æ–Ω', data.phone));

        // –î–æ–ø. —É–∫–∞–∑–∞–Ω–∏—è
        const hints = detectHintsByType(type);
        const extra = [
            '1) –°—Ñ–æ—Ä–º–∏—Ä—É–π –ü–û–õ–ù–´–ô —é—Ä–∏–¥–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–æ–≥–æ–≤–æ—Ä–∞ –ø–æ –ø—Ä–∞–≤—É –†–§ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.',
            '2) –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π Markdown –∏ –Ω–µ –¥–æ–±–∞–≤–ª—è–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ‚Äî —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç –¥–æ–≥–æ–≤–æ—Ä–∞.',
            '3) –ü—Ä–∏–¥–µ—Ä–∂–∏–≤–∞–π—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ä–∞–∑–¥–µ–ª–æ–≤ –∏ –µ–¥–∏–Ω–æ–π —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏.',
            '4) –°—É–º–º—ã, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω—ã, –ø—Ä–æ–¥—É–±–ª–∏—Ä—É–π —Ü–∏—Ñ—Ä–∞–º–∏ –∏ –ø—Ä–æ–ø–∏—Å—å—é.',
            '5) –î–ª—è —é—Ä–ª–∏—Ü –¥–æ–±–∞–≤—å —Ä–µ–∫–≤–∏–∑–∏—Ç—ã, –¥–ª—è —Ñ–∏–∑–ª–∏—Ü ‚Äî –ø–∞—Å–ø–æ—Ä—Ç–Ω—ã–µ/–∞–¥—Ä–µ—Å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ –æ–Ω–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã.',
            '6) –í –∫–æ–Ω—Ü–µ –¥–æ–≥–æ–≤–æ—Ä–∞ ‚Äî —Ä–µ–∫–≤–∏–∑–∏—Ç—ã —Å—Ç–æ—Ä–æ–Ω –∏ –±–ª–æ–∫ –ø–æ–¥–ø–∏—Å–µ–π —Å –º–µ—Å—Ç–æ–º –∏ –¥–∞—Ç–æ–π.',
            '7) –ù–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–∞—Å–ø–æ—Ä—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –ò–ù–ù/–û–ì–†–ù, VIN, –∞–¥—Ä–µ—Å–∞ ‚Äî –æ—Å—Ç–∞–≤–ª—è–π "___".',
            '8) –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–≤—è–∑–∏ –∏ –Ω–µ –≤–∫–ª—é—á–∞—é—Ç—Å—è –≤ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ—É–º–µ—Å—Ç–Ω–æ.',
            '',
            '–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:',
            '‚Äî –ü—Ä–µ–¥–º–µ—Ç –¥–æ–≥–æ–≤–æ—Ä–∞',
            '‚Äî –ü—Ä–∞–≤–∞ –∏ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ —Å—Ç–æ—Ä–æ–Ω',
            '‚Äî –¶–µ–Ω–∞ –∏ –ø–æ—Ä—è–¥–æ–∫ —Ä–∞—Å—á–µ—Ç–æ–≤',
            '‚Äî –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∏ –ø–æ—Ä—è–¥–æ–∫ —Ä–∞—Å—Ç–æ—Ä–∂–µ–Ω–∏—è',
            '‚Äî –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç–æ—Ä–æ–Ω –∏ –Ω–µ—É—Å—Ç–æ–π–∫–∞',
            '‚Äî –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–∏–µ–º–∫–∏ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)',
            '‚Äî –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)',
            '‚Äî –ü—Ä–∞–≤–∞ –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–±–æ—Ç/–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)',
            '‚Äî –§–æ—Ä—Å-–º–∞–∂–æ—Ä',
            '‚Äî –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Å–ø–æ—Ä–æ–≤ (–ø–æ–¥—Å—É–¥–Ω–æ—Å—Ç—å –≤ –†–§)',
            '‚Äî –ó–∞–∫–ª—é—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è',
            '‚Äî –†–µ–∫–≤–∏–∑–∏—Ç—ã –∏ –ø–æ–¥–ø–∏—Å–∏ —Å—Ç–æ—Ä–æ–Ω',
            '‚Äî –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Å–º–µ—Ç–∞/–¢–ó/–≥—Ä–∞—Ñ–∏–∫/—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Äî –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏)',
            '',
            '–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ —Ç–∏–ø—É –¥–æ–≥–æ–≤–æ—Ä–∞:',
            ...(hints.length ? hints.map((h, i) => `${i + 1}. ${h}`) : ['–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –¥–æ–≥–æ–≤–æ—Ä–∞.']),
        ].join('\n');

        // ==== –í–æ–∑–≤—Ä–∞—Ç –ø—Ä–æ–º–ø—Ç–∞ ====
        return `–¢—ã ‚Äî –æ–ø—ã—Ç–Ω—ã–π —é—Ä–∏—Å—Ç –ø–æ –¥–æ–≥–æ–≤–æ—Ä–Ω–æ–º—É –ø—Ä–∞–≤—É –†–§. –ü–æ–¥–≥–æ—Ç–æ–≤—å –∏—Ç–æ–≥–æ–≤—ã–π –¥–æ–≥–æ–≤–æ—Ä –≤ –≤–∏–¥–µ —á–∏—Å—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞, –ø—Ä–∏–≥–æ–¥–Ω–æ–≥–æ –¥–ª—è –ø–µ—á–∞—Ç–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ DOC/PDF.

–ò—Å–ø–æ–ª—å–∑—É–π —Å–ª–µ–¥—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ:  

----- 

üì• –î–∞–Ω–Ω—ã–µ –æ—Ç –∑–∞–∫–∞–∑—á–∏–∫–∞:
${parts.join('\n')}
----- 

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–∫–∞–∑–∞–Ω–∏—è:
${extra}
`;
    } catch (err) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–º–ø—Ç–∞:', err.message, err.stack);
        throw err;
    }
};
