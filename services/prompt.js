module.exports = function generatePrompt(data) {
  try {
    if (!data) throw new Error('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–º–ø—Ç–∞');

    const parts = [];

    if (data.supportType) parts.push(`- –¶–µ–ª—å –±–∏–∑–Ω–µ—Å-–ø–ª–∞–Ω–∞: ${data.supportType}`);
    if (data.businessName) parts.push(`- –ù–∞–∑–≤–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å–∞: ${data.businessName}`);
    if (data.businessForm) parts.push(`- –§–æ—Ä–º–∞ –±–∏–∑–Ω–µ—Å–∞: ${data.businessForm}`);
    if (data.businessDescription) parts.push(`- –û–ø–∏—Å–∞–Ω–∏–µ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: ${data.businessDescription}`);
    if (data.location) parts.push(`- –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å–∞: ${data.location}`);
    if (data.startupAmount) parts.push(`- –û–±—â–∞—è —Å—É–º–º–∞ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞ (–≤–∫–ª—é—á–∞—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ): ${data.startupAmount} —Ä—É–±.`);
    if (data.spendingPurpose) parts.push(`- –ù–∞ —á—Ç–æ –ø–æ–π–¥—É—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞: ${data.spendingPurpose}`);
    if (data.ownMoney) parts.push(`- –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–ª–æ–∂–µ–Ω–∏—è: ${data.ownMoney} —Ä—É–±.`);
    if (data.ownAssets) parts.push(`- –ù–µ–¥–µ–Ω–µ–∂–Ω—ã–µ –≤–ª–æ–∂–µ–Ω–∏—è: ${data.ownAssets}`);
    if (data.clientsPerMonth) parts.push(`- –û–∂–∏–¥–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ –º–µ—Å—è—Ü: ${data.clientsPerMonth}`);
    if (data.productPrices) parts.push(`- –¶–µ–Ω—ã –Ω–∞ —Ç–æ–≤–∞—Ä—ã/—É—Å–ª—É–≥–∏: ${data.productPrices}`);
    if (data.targetClients) parts.push(`- –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è: ${data.targetClients}`);
    if (data.competitors) parts.push(`- –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã: ${data.competitors}`);
    if (data.advantages) parts.push(`- –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –±–∏–∑–Ω–µ—Å–∞: ${data.advantages}`);
    if (data.needsRepair) parts.push(`- –ù—É–∂–µ–Ω –ª–∏ —Ä–µ–º–æ–Ω—Ç –ø–æ–º–µ—â–µ–Ω–∏—è: ${data.needsRepair}`);
    if (data.repairCost) parts.push(`- –°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–µ–º–æ–Ω—Ç–∞: ${data.repairCost} —Ä—É–±.`);
    if (data.rawMaterials) parts.push(`- –ò—Å—Ç–æ—á–Ω–∏–∫–∏ —Å—ã—Ä—å—è: ${data.rawMaterials}`);
    if (data.lifeImprovement) parts.push(`- –ö–∞–∫ –±–∏–∑–Ω–µ—Å —É–ª—É—á—à–∏—Ç –≤–∞—à–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ: ${data.lifeImprovement}`);
    if (data.socialImpact) parts.push(`- –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ–ª—å–∑–∞ –æ—Ç –±–∏–∑–Ω–µ—Å–∞: ${data.socialImpact}`);
    if (data.hasExperience) parts.push(`- –ù–∞–ª–∏—á–∏–µ –æ–ø—ã—Ç–∞ –≤ —Å—Ñ–µ—Ä–µ: ${data.hasExperience}`);
    if (data.experienceDetails) parts.push(`- –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –æ–ø—ã—Ç–∞: ${data.experienceDetails}`);
    if (data.risks) parts.push(`- –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–∏—Å–∫–∏: ${data.risks}`);
    if (data.hiringPlans) parts.push(`- –ü–ª–∞–Ω—ã –ø–æ –Ω–∞–π–º—É —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤: ${data.hiringPlans}`);

        // üß† –õ–æ–≥–∏–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –§–ò–û –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –ø—Ä–∏ –ò–ü/—Å–∞–º–æ–∑–∞–Ω—è—Ç—ã–π
    let personalFormNote = '';
    if (
      ["–ò–ü", "–°–∞–º–æ–∑–∞–Ω—è—Ç—ã–π"].includes(data.businessForm) &&
      /\b[–ê-–Ø–Å][–∞-—è—ë]+ [–ê-–Ø–Å][–∞-—è—ë]+ [–ê-–Ø–Å][–∞-—è—ë]+/.test(data.businessName || '')
    ) {
      personalFormNote = '- ‚ö†Ô∏è –ü–∏—à–∏ –æ—Ç **–ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞** (—è, –º–æ–π –±–∏–∑–Ω–µ—Å), –∞ –Ω–µ –æ—Ç —Ç—Ä–µ—Ç—å–µ–≥–æ (–æ–Ω, –µ—ë, –µ–≥–æ).';
    }

    const commonInstructions = `
üìå –§–æ—Ä–º–∞—Ç –∏ —Å—Ç–∏–ª—å:
- –ü–∏—à–∏ –≤ **Markdown**:
  - \`# –ó–∞–≥–æ–ª–æ–≤–æ–∫\` ‚Äî —Ä–∞–∑–¥–µ–ª
  - \`## –ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫\` ‚Äî –ø–æ –∂–µ–ª–∞–Ω–∏—é
  - \`- –ø—É–Ω–∫—Ç —Å–ø–∏—Å–∫–∞\` ‚Äî —Å–ø–∏—Å–∫–∏
  - \`**–∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç**\` ‚Äî –¥–ª—è –∞–∫—Ü–µ–Ω—Ç–æ–≤
- **–ù–µ –ø–∏—à–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–ª—è "–¢–∏—Ç—É–ª—å–Ω–æ–≥–æ –ª–∏—Å—Ç–∞" –∏ "–°–æ–¥–µ—Ä–∂–∞–Ω–∏—è"** ‚Äî –æ–Ω–∏ –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –æ—Ç–¥–µ–ª—å–Ω–æ.
- –°—Ç—Ä–æ–≥–∏–π –¥–µ–ª–æ–≤–æ–π —Å—Ç–∏–ª—å. –ë–µ–∑ "–≤–æ–¥—ã", –º–µ—Ç–∞—Ñ–æ—Ä, —É–∫—Ä–∞—à–µ–Ω–∏–π.
- –ë–µ–∑ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –û–ö–í–≠–î, Canvas, SWOT, –º–æ–¥–µ–ª–µ–π.
- –ù–µ –ø—É—Ç–∞–π –Ω–∞–∑–≤–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å–∞ —Å –§–ò–û –≤–ª–∞–¥–µ–ª—å—Ü–∞ (–æ—Å–æ–±–µ–Ω–Ω–æ –ò–ü/—Å–∞–º–æ–∑–∞–Ω—è—Ç–æ—Å—Ç—å).
- –í—Å–µ —Å—É–º–º—ã —É–∫–∞–∑—ã–≤–∞—Ç—å –≤ **—Ä—É–±–ª—è—Ö**.
- **–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ç–æ—á–Ω—ã–º:
  - –û–±—â–∞—è —Å—É–º–º–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤ ‚â§ —Å—Ç–∞—Ä—Ç–æ–≤–∞—è —Å—É–º–º–∞
  - –£—á—ë—Ç –Ω–∞–ª–æ–≥–æ–≤: –£–°–ù 6% –∏–ª–∏ 15%, –ü–∞—Ç–µ–Ω—Ç –∏ –¥—Ä.
  - –ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å = –î–æ—Ö–æ–¥ ‚Äì –†–∞—Å—Ö–æ–¥ ‚Äì –ù–∞–ª–æ–≥–∏
  - –ï—Å–ª–∏ —É–∫–∞–∑—ã–≤–∞–µ—à—å —Å—Ä–æ–∫ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏ ‚Äî –æ–Ω –¥–æ–ª–∂–µ–Ω —Å—Ö–æ–¥–∏—Ç—å—Å—è –ø–æ —Ä–∞—Å—á—ë—Ç–∞–º.
  ${personalFormNote}
`;

    let structure = '';

    switch (data.supportType) {
      case "–î–ª—è —Å–æ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞":
        structure = `
1. –†–µ–∑—é–º–µ –ø—Ä–æ–µ–∫—Ç–∞ (300‚Äì400 —Å–ª–æ–≤)
2. –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–π –ø–ª–∞–Ω (400‚Äì500 —Å–ª–æ–≤)
3. –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–π –ø–ª–∞–Ω (500‚Äì600 —Å–ª–æ–≤)
4. –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–ª–∞–Ω (400‚Äì500 —Å–ª–æ–≤)
5. –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–ª–∞–Ω (400‚Äì500 —Å–ª–æ–≤)
6. –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–ª–∞–Ω (800‚Äì1000 —Å–ª–æ–≤)
7. –ê–Ω–∞–ª–∏–∑ —Ä–∏—Å–∫–æ–≤ (400‚Äì500 —Å–ª–æ–≤)
`;
        break;

      case "–ì—Ä–∞–Ω—Ç–∞":
        structure = `
1. –†–µ–∑—é–º–µ –ø—Ä–æ–µ–∫—Ç–∞ (300‚Äì400 —Å–ª–æ–≤)
2. –û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ –∏ –∫–æ–º–∞–Ω–¥—ã (400‚Äì500 —Å–ª–æ–≤)
3. –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã –∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ (400‚Äì500 —Å–ª–æ–≤)
4. –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞/—É—Å–ª—É–≥–∏ (500‚Äì600 —Å–ª–æ–≤)
5. –ê–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–∞ –∏ —Ü–µ–ª–µ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏ (500‚Äì600 —Å–ª–æ–≤)
6. –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è (500‚Äì600 —Å–ª–æ–≤)
7. –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ (600‚Äì800 —Å–ª–æ–≤)
8. –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–ª–∞–Ω (800‚Äì1000 —Å–ª–æ–≤)
9. –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ —ç—Ñ—Ñ–µ–∫—Ç (400‚Äì500 —Å–ª–æ–≤)
10. –ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ (400‚Äì500 —Å–ª–æ–≤)
`;
        break;

      case "–ö—Ä–µ–¥–∏—Ç–∞":
        structure = `
1. –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ (300‚Äì400 —Å–ª–æ–≤)
2. –°–≤–µ–¥–µ–Ω–∏—è –æ –∑–∞—ë–º—â–∏–∫–µ (200‚Äì300 —Å–ª–æ–≤)
3. –¶–µ–ª—å –∫—Ä–µ–¥–∏—Ç–æ–≤–∞–Ω–∏—è (300‚Äì400 —Å–ª–æ–≤)
4. –û–ø–∏—Å–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å–∞ (400‚Äì500 —Å–ª–æ–≤)
5. –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–ª–∞–Ω (800‚Äì1000 —Å–ª–æ–≤)
6. –ì—Ä–∞—Ñ–∏–∫ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫—Ä–µ–¥–∏—Ç–∞ (400‚Äì500 —Å–ª–æ–≤)
7. –ê–Ω–∞–ª–∏–∑ —Ä–∏—Å–∫–æ–≤ (400‚Äì500 —Å–ª–æ–≤)
8. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ –æ –ø–ª–∞—Ç—ë–∂–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ (300‚Äì400 —Å–ª–æ–≤)
`;
        break;

      default:
        structure = `
1. –í–≤–µ–¥–µ–Ω–∏–µ –∏ —Ü–µ–ª–∏ (300‚Äì400 —Å–ª–æ–≤)
2. –û–ø–∏—Å–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å–∞ (400‚Äì500 —Å–ª–æ–≤)
3. –û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤/—É—Å–ª—É–≥ (400‚Äì500 —Å–ª–æ–≤)
4. –ê–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–∞ (400‚Äì500 —Å–ª–æ–≤)
5. –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è (400‚Äì500 —Å–ª–æ–≤)
6. –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–ª–∞–Ω (300‚Äì400 —Å–ª–æ–≤)
7. –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–ª–∞–Ω (800‚Äì1000 —Å–ª–æ–≤)
8. –í—ã–≤–æ–¥—ã –∏ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã (300‚Äì400 —Å–ª–æ–≤)
`;
    }

    return `
–¢—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –±–∏–∑–Ω–µ—Å-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç.

–ù–∞–ø–∏—à–∏ –ø–æ–¥—Ä–æ–±–Ω—ã–π –±–∏–∑–Ω–µ—Å-–ø–ª–∞–Ω –ø–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ:

${structure}

${commonInstructions}

üì• –î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞:
${parts.join('\n')}

‚ö° –û–±—ä—ë–º —Ç–µ–∫—Å—Ç–∞ ‚Äî –Ω–µ –º–µ–Ω–µ–µ **10 –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü Word** (–ø—Ä–∏–º–µ—Ä–Ω–æ 4500‚Äì6000 —Å–ª–æ–≤).
‚ö° –ö–∞–∂–¥—ã–π —Ä–∞–∑–¥–µ–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–∞—Å–∫—Ä—ã—Ç –∏ –ª–æ–≥–∏—á–µ—Å–∫–∏ –∑–∞–≤–µ—Ä—à—ë–Ω.
‚ö° –§–æ—Ä–º–∞—Ç –ø—Ä–∏–≥–æ–¥–µ–Ω –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ Word —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –∏ –æ—Ç—Å—Ç—É–ø–∞–º–∏.
`;
  } catch (err) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–º–ø—Ç–∞:', err.message, err.stack);
    throw err;
  }
};
